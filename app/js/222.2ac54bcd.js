"use strict";(self["webpackChunktppa_app"]=self["webpackChunktppa_app"]||[]).push([[222],{3143:(e,t,s)=>{s.r(t),s.d(t,{default:()=>x});var o=s(83673),n=s(62323);function i(e,t,s,i,a,r){const l=(0,o.up)("Authorization"),c=(0,o.up)("ChangePassword"),u=(0,o.up)("q-page");return(0,o.wg)(),(0,o.j4)(u,{class:(0,n.C_)(["flex flex-center fullscreen bg-matrix",e.$q.dark.isActive?"bg-matrix-dark":""])},{default:(0,o.w5)((()=>[e.$root.isLogin?e.requireUpdatePwd?((0,o.wg)(),(0,o.j4)(c,{key:1,allowskip:!0,userid:e.getObj(e.$root.authenticated,"data.userid"),onSuccess:e.alertOnPassChange,onFailed:e.alertOnPassChange,onSkip:e.redirectOnLogin},null,8,["userid","onSuccess","onFailed","onSkip"])):(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(l,{key:0,alert:e.doAlert,allow_signup:!!e.getObj(e.$root,"server_info.setup"),icon_click:()=>e.$root.app_settings.darkmode=!e.$root.app_settings.darkmode,onSuccess:e.onLoginResponse,onFailed:e.onLoginResponse},null,8,["alert","allow_signup","icon_click","onSuccess","onFailed"]))])),_:1},8,["class"])}var a=s(93617),r=s(26386);const l={class:"row"},c=(0,o.Uk)(" Verifying ");function u(e,t,s,i,a,r){const u=(0,o.up)("q-icon"),d=(0,o.up)("q-btn"),p=(0,o.up)("q-toolbar-title"),m=(0,o.up)("q-toolbar"),g=(0,o.up)("q-input"),h=(0,o.up)("InputPassword"),w=(0,o.up)("q-space"),y=(0,o.up)("q-spinner-facebook"),f=(0,o.up)("q-form"),_=(0,o.up)("q-card");return(0,o.wg)(),(0,o.j4)(_,{style:{width:"500px","max-width":"80vw","border-radius":"15px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(m,{class:"bg-primary text-white"},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{flat:"",ripple:"","no-caps":"",size:"md",class:"no-margin no-padding q-pa-none q-ma-none",onClick:e.icon_click},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{size:"lg",class:"bg-white",color:"primary",name:"img:assets/icons/favicon-96x96.png"})])),_:1},8,["onClick"]),(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)((e.$q.screen.gt.sm?e.company.name_short:e.company.name_abbr)||"")+" Portal",1)])),_:1}),e.allow_signup?((0,o.wg)(),(0,o.j4)(d,{key:0,flat:"",round:"",size:"md",color:"grey-3",icon:"admin_panel_settings",onClick:t[0]||(t[0]=t=>e.$root.dialogAddUser=!e.$root.dialogAddUser)})):(0,o.kq)("",!0)])),_:1}),(0,o.Wm)(f,{onSubmit:e.loginWithPassword,ref:e.form_conf.ref,class:"q-pa-md q-gutter-xs"},{default:(0,o.w5)((()=>[(0,o._)("div",null,[(0,o.Wm)(g,{rounded:"",outlined:"",autofocus:"",clearable:"","clear-icon":"clear",label:"Username or Userid","input-class":e.form_conf.inputclass,modelValue:e.u_useridentity,"onUpdate:modelValue":t[1]||(t[1]=t=>e.u_useridentity=t),rules:[t=>e.checker.input(!!t||"Identity is required!",500),t=>e.checker.input(t&&t.length>3||"Username is too short!",500)],onKeyup:e.modKey},{prepend:(0,o.w5)((()=>[(0,o.Wm)(u,{size:"xs",name:"person"})])),_:1},8,["input-class","modelValue","rules","onKeyup"])]),(0,o._)("div",null,[(0,o.Wm)(h,{rounded:"",outlined:"",clearable:"","lazy-rules":"",autocomplete:"",label:"Password","clear-icon":"clear",modelValue:e.u_password,"onUpdate:modelValue":t[2]||(t[2]=t=>e.u_password=t),"input-class":e.form_conf.inputclass,onKeyup:e.modKey,rules:[t=>e.checker.input(!!t||"Password is required!",500),t=>e.checker.input(t&&t.length>3||"Password is too short!",500)]},null,8,["modelValue","input-class","onKeyup","rules"])]),(0,o._)("div",l,[(0,o.Wm)(w),(0,o.Wm)(d,{ripple:"","no-caps":"",rounded:"",size:"md",unelevated:"",color:"primary",class:"q-px-xl",label:"Validate",loading:e.decrypting.status,percentage:e.decrypting.percentage,onClick:e.submitValidation},{loading:(0,o.w5)((()=>[(0,o.Wm)(y,{size:"xs",class:"on-left"}),c])),_:1},8,["loading","percentage","onClick"])])])),_:1},8,["onSubmit"])])),_:1})}var d=s(48825),p=s(22151);const m=(0,o.aZ)({name:"Authorization",components:{InputPassword:p.Z},data(){return{$q:(0,d.Z)(),checker:r.ZZ,loginAnimate:null,u_useridentity:null,u_password:null,interval:null,login_response:null,decrypting:{status:!1,percentage:0},form_conf:{ref:"authorization_form",inputclass:"form_active_input"}}},emits:["success","failed","close","loading"],props:{icon_click:{type:Function},allow_signup:{type:Boolean,default:!1}},computed:{...(0,a.rn)("user",["authenticated"]),...(0,a.rn)("company",["company"])},watch:{login_response:{async handler(e){e&&((0,r.NS)(this.loginAnimate),setTimeout((()=>{this.decrypting.status=!1}),500))},deep:!0}},methods:{...(0,a.nv)("user",["loginWithPwd"]),submitValidation(){const e=(0,r.Sw)(this.$refs,`${this.form_conf.ref}`);e&&e.submit()},async loginWithPassword(){this.loginLoading(),this.login_response=null;const e={password:r.US.encode(this.u_password)};isNaN(this.u_useridentity)?e.username=this.u_useridentity.toLowerCase():e.userid=this.u_useridentity,this.$emit("loading",e);let t=await this.loginWithPwd(e);this.login_response=(0,r.Sw)(t,"response.data",{}),this.$emit((0,r.Sw)(this.login_response,"success")?"success":"failed",this.login_response,e)},async loginLoading(e){this.decrypting.status=!0,this.loginAnimate=setInterval((()=>{this.decrypting.percentage+=Math.floor(8*Math.random()+10),this.decrypting.percentage>=100&&(e&&e(),this.decrypting.status=!1,(0,r.NS)(this.loginAnimate))}),1e3)},async modKey(e){switch(e.key){case"Enter":if(e.preventDefault(),e.ctrlKey&&e.shiftKey&&e.altKey);else if(e.altKey);else if(e.shiftKey)(0,r.A_)(e,!1);else if(e.ctrlKey)this.submitValidation();else{const t=await(0,r.A_)(e);t||this.$refs[this.form_conf.ref].submit()}break;default:break}}},beforeUnmount(){this.$emit("close")}});var g=s(74260),h=s(10151),w=s(39570),y=s(2165),f=s(24554),_=s(13747),k=s(68689),b=s(34842),q=s(62025),$=s(38719),P=s(7518),v=s.n(P);const S=(0,g.Z)(m,[["render",u]]),U=S;v()(m,"components",{QCard:h.Z,QToolbar:w.Z,QBtn:y.Z,QIcon:f.Z,QToolbarTitle:_.Z,QForm:k.Z,QInput:b.Z,QSpace:q.Z,QSpinnerFacebook:$.Z});var Z=s(66438);const A=(0,o.aZ)({name:"PageAuth",data(){return{$q:(0,d.Z)(),getObj:r.Sw,doAlert:!0,requireUpdatePwd:!1}},components:{Authorization:U,ChangePassword:Z.Z},computed:{...(0,a.rn)("user",["authenticated"])},async created(){this.$root.setMeta({title:"Authentication"})},methods:{async onLoginResponse(e,t){e.success&&(r.ZZ.regexp.password.test(r.US.decode(t.password))?(this.$root.setMeta({title:"Update Password"}),this.requireUpdatePwd=!0):this.redirectOnLogin()),this.$q.notify({message:e.success?`Welcome, @${(0,r.Sw)(this.authenticated,"data.username","")}!`:(0,r.Sw)(e,"error.message","Unknown Error"),timeout:3e3,progress:!0,type:e.success?"positive":"negative",position:e.success&&!this.requireUpdatePwd?"bottom-left":"bottom"}),e.success&&this.requireUpdatePwd&&this.$q.notify({message:"Please update your password!",timeout:5e3,type:"warning",position:"bottom"})},redirectOnLogin(){this.$router.push(this.$route.query.redirect||"/"),(0,r.Sw)(this.$root.company,"name")||0!==this.$root.accessLevel||(this.$root.dialogCompanySettings=!0)},async alertOnPassChange(e){e&&(this.$q.notify({message:e.success?"Password Updated":"Update Failed",timeout:3e3,type:e.success?"positive":"negative"}),e.success&&(this.requireUpdatePwd=!1,this.redirectOnLogin()))}}});var C=s(24379);const W=(0,g.Z)(A,[["render",i]]),x=W;v()(A,"components",{QPage:C.Z})}}]);