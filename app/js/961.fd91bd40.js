"use strict";(self["webpackChunktppa_app"]=self["webpackChunktppa_app"]||[]).push([[961],{8199:(e,t,s)=>{s.r(t),s.d(t,{default:()=>K});var n=s(3673),o=s(2323);const i={class:"width: 500px"};function a(e,t,s,a,r,l){const c=(0,n.up)("Authorization"),u=(0,n.up)("ChangePassword"),d=(0,n.up)("q-page");return(0,n.wg)(),(0,n.j4)(d,{class:(0,o.C_)(["flex fullscreen q-pa-md flex-center bg-matrix",e.$q.dark.isActive?"bg-matrix-dark":""])},{default:(0,n.w5)((()=>[(0,n._)("div",i,[e.$root.isLogin?e.requireUpdatePwd?((0,n.wg)(),(0,n.j4)(u,{key:1,allowskip:!0,userid:e.getObj(e.$root.authenticated,"data.userid"),onSuccess:e.alertOnPassChange,onFailed:e.alertOnPassChange,onSkip:e.redirectOnLogin},null,8,["userid","onSuccess","onFailed","onSkip"])):(0,n.kq)("",!0):((0,n.wg)(),(0,n.j4)(c,{key:0,alert:e.doAlert,allow_signup:!!e.getObj(e.$root,"server_info.setup"),icon_click:()=>e.$root.app_settings.darkmode=!e.$root.app_settings.darkmode,onSuccess:e.onLoginResponse,onFailed:e.onLoginResponse},null,8,["alert","allow_signup","icon_click","onSuccess","onFailed"]))])])),_:1},8,["class"])}var r=s(3617),l=s(6386);const c={class:"row"},u=(0,n.Uk)(" Verifying ");function d(e,t,s,i,a,r){const l=(0,n.up)("q-icon"),d=(0,n.up)("q-btn"),p=(0,n.up)("q-toolbar-title"),m=(0,n.up)("q-toolbar"),g=(0,n.up)("q-input"),h=(0,n.up)("InputPassword"),w=(0,n.up)("q-space"),y=(0,n.up)("q-spinner-facebook"),f=(0,n.up)("q-form"),_=(0,n.up)("q-card");return(0,n.wg)(),(0,n.j4)(_,{style:{width:"500px","max-width":"80vw","border-radius":"15px"}},{default:(0,n.w5)((()=>[(0,n.Wm)(m,{class:"bg-primary text-white"},{default:(0,n.w5)((()=>[(0,n.Wm)(d,{flat:"",ripple:"","no-caps":"",size:"md",class:"no-margin no-padding q-pa-none q-ma-none",onClick:e.icon_click},{default:(0,n.w5)((()=>[(0,n.Wm)(l,{size:"lg",class:"bg-white",style:{padding:"0px"},name:"img:icons/favicon-96x96.png"})])),_:1},8,["onClick"]),(0,n.Wm)(p,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,o.zw)((e.$q.screen.gt.sm?e.company.name_short:e.company.name_abbr)||"")+" Portal",1)])),_:1}),e.allow_signup?((0,n.wg)(),(0,n.j4)(d,{key:0,flat:"",round:"",size:"md",color:"grey-3",icon:"admin_panel_settings",onClick:t[0]||(t[0]=t=>e.$root.dialogAddUser=!e.$root.dialogAddUser)})):(0,n.kq)("",!0)])),_:1}),(0,n.Wm)(f,{onSubmit:e.loginWithPassword,ref:e.form_conf.ref,class:"q-pa-md q-gutter-xs"},{default:(0,n.w5)((()=>[(0,n._)("div",null,[(0,n.Wm)(g,{rounded:"",outlined:"",autofocus:"",clearable:"","clear-icon":"clear",label:"Username or Userid","input-class":e.form_conf.inputclass,modelValue:e.u_useridentity,"onUpdate:modelValue":t[1]||(t[1]=t=>e.u_useridentity=t),rules:[t=>e.checker.input(!!t||"Identity is required!",500),t=>e.checker.input(t&&t.length>3||"Username is too short!",500)],onKeyup:e.modKey},{prepend:(0,n.w5)((()=>[(0,n.Wm)(l,{size:"xs",name:"person"})])),_:1},8,["input-class","modelValue","rules","onKeyup"])]),(0,n._)("div",null,[(0,n.Wm)(h,{rounded:"",outlined:"",clearable:"","lazy-rules":"",autocomplete:"",label:"Password","clear-icon":"clear",modelValue:e.u_password,"onUpdate:modelValue":t[2]||(t[2]=t=>e.u_password=t),"input-class":e.form_conf.inputclass,onKeyup:e.modKey,rules:[t=>e.checker.input(!!t||"Password is required!",500),t=>e.checker.input(t&&t.length>3||"Password is too short!",500)]},null,8,["modelValue","input-class","onKeyup","rules"])]),(0,n._)("div",c,[(0,n.Wm)(w),(0,n.Wm)(d,{ripple:"","no-caps":"",rounded:"",size:"md",unelevated:"",color:"primary",class:"q-px-xl",label:"Validate",loading:e.decrypting.status,percentage:e.decrypting.percentage,onClick:e.submitValidation},{loading:(0,n.w5)((()=>[(0,n.Wm)(y,{size:"xs",class:"on-left"}),u])),_:1},8,["loading","percentage","onClick"])])])),_:1},8,["onSubmit"])])),_:1})}var p=s(8825),m=s(8018);const g=(0,n.aZ)({name:"Authorization",components:{InputPassword:m.Z},data(){return{$q:(0,p.Z)(),checker:l.ZZ,loginAnimate:null,u_useridentity:null,u_password:null,interval:null,login_response:null,decrypting:{status:!1,percentage:0},form_conf:{ref:"authorization_form",inputclass:"form_active_input"}}},emits:["success","failed","close","loading"],props:{icon_click:{type:Function},allow_signup:{type:Boolean,default:!1}},computed:{...(0,r.rn)("user",["authenticated"]),...(0,r.rn)("company",["company"])},watch:{login_response:{async handler(e){e&&((0,l.NS)(this.loginAnimate),setTimeout((()=>{this.decrypting.status=!1}),500))},deep:!0}},methods:{...(0,r.nv)("user",["loginWithPwd"]),submitValidation(){const e=(0,l.Sw)(this.$refs,`${this.form_conf.ref}`);e&&e.submit()},async loginWithPassword(){this.loginLoading(),this.login_response=null;const e={password:l.US.encode(this.u_password)};isNaN(this.u_useridentity)?e.username=this.u_useridentity.toLowerCase():e.userid=this.u_useridentity,this.$emit("loading",e);let t=await this.loginWithPwd(e);this.login_response=(0,l.Sw)(t,"response.data",{}),this.$emit((0,l.Sw)(this.login_response,"success")?"success":"failed",this.login_response,e)},async loginLoading(e){this.decrypting.status=!0,this.loginAnimate=setInterval((()=>{this.decrypting.percentage+=Math.floor(8*Math.random()+10),this.decrypting.percentage>=100&&(e&&e(),this.decrypting.status=!1,(0,l.NS)(this.loginAnimate))}),1e3)},async modKey(e){switch(e.key){case"Enter":if(e.preventDefault(),e.ctrlKey&&e.shiftKey&&e.altKey);else if(e.altKey);else if(e.shiftKey)(0,l.A_)(e,!1);else if(e.ctrlKey)this.submitValidation();else{const t=await(0,l.A_)(e);t||this.$refs[this.form_conf.ref].submit()}break;default:break}}},beforeUnmount(){this.$emit("close")}});var h=s(4260),w=s(151),y=s(9570),f=s(2165),_=s(4554),k=s(3747),b=s(5269),q=s(4842),$=s(2025),P=s(8719),v=s(7518),S=s.n(v);const U=(0,h.Z)(g,[["render",d]]),Z=U;S()(g,"components",{QCard:w.Z,QToolbar:y.Z,QBtn:f.Z,QIcon:_.Z,QToolbarTitle:k.Z,QForm:b.Z,QInput:q.Z,QSpace:$.Z,QSpinnerFacebook:P.Z});var x=s(1594);const A=(0,n.aZ)({name:"PageAuth",data(){return{$q:(0,p.Z)(),getObj:l.Sw,doAlert:!0,requireUpdatePwd:!1}},components:{Authorization:Z,ChangePassword:x.Z},computed:{...(0,r.rn)("user",["authenticated"])},async created(){this.$root.setMeta({title:"Authentication"})},methods:{async onLoginResponse(e,t){e.success&&(l.ZZ.regexp.password.test(l.US.decode(t.password))?(this.$root.setMeta({title:"Update Password"}),this.requireUpdatePwd=!0):this.redirectOnLogin()),this.$q.notify({message:e.success?`Welcome, @${(0,l.Sw)(this.authenticated,"data.username","")}!`:(0,l.Sw)(e,"error.message","Unknown Error"),timeout:3e3,progress:!0,type:e.success?"positive":"negative",position:e.success&&!this.requireUpdatePwd?"bottom-left":"bottom"}),e.success&&this.requireUpdatePwd&&this.$q.notify({message:"Please update your password!",timeout:5e3,type:"warning",position:"bottom"})},redirectOnLogin(){this.$router.push(this.$route.query.redirect||"/"),(0,l.Sw)(this.$root.company,"name")||0!==this.$root.accessLevel||(this.$root.dialogCompanySettings=!0)},async alertOnPassChange(e){e&&(this.$q.notify({message:e.success?"Password Updated":"Update Failed",timeout:3e3,type:e.success?"positive":"negative"}),e.success&&(this.requireUpdatePwd=!1,this.redirectOnLogin()))}}});var C=s(4379);const W=(0,h.Z)(A,[["render",a]]),K=W;S()(A,"components",{QPage:C.Z})}}]);